/*
* Copyright (c) 2013 Johannes Mittendorfer (http://johannes-mittendorfer.com)
* Licensed under the MIT License (LICENSE.txt).
*
* Version 1.1.3 2013-12-01 
*/

!function(a){"use strict";a.fn.EAN13=function(b,c){var d={prefix_offset:.07,font_stretch:.078,border_line_height_number:.9,border_line_height:1,line_height:.9,font_size:.2,font_y:1.03},e=a.extend({number:!0,prefix:!0,onValid:function(){},onInvalid:function(){},onError:function(){},color:"#000"},c),f=this[0];return this.each(function(){function c(b){var c=null,d=b.split(""),e=0;return a.each(d,function(a,b){e+=a%2===1?parseInt(b,10):3*parseInt(b,10)}),c=e%10===0?!0:!1}c(b)?e.onValid.call(this):e.onInvalid.call(this);var g,h,i=["0001101","0011001","0010011","0111101","0100011","0110001","0101111","0111011","0110111","0001011"],j=["0100111","0110011","0011011","0100001","0011101","0111001","0000101","0010001","0001001","0010111"],k=["1110010","1100110","1101100","1000010","1011100","1001110","1010000","1000100","1001000","1110100"],l=["xxxxxx","xxyxyy","xxyyxy","xxyyyx","xyxxyy","xyyxxy","xyyyxx","xyxyxy","xyxyyx","xyyxyx"],m=e.prefix?.8*f.width:f.width;e.number?(g=d.border_line_height_number*f.height,h=d.line_height*g):(g=d.border_line_height*f.height,h=d.line_height*g);var n=m/95,o="",p=l[parseInt(b.substr(0,1),10)].split(""),q=b.substr(0,1);b=b.substr(1);for(var r=b.split(""),s=0;6>s;s++)o+="x"===p[s]?i[r[s]]:j[r[s]];for(s=6;12>s;s++)o+=k[r[s]];if(f.getContext){var t=f.getContext("2d");t.fillStyle=e.color;var u=e.prefix?f.width*d.prefix_offset:0,v=o.split("");for(t.fillRect(u,0,n,g),u+=2*n,t.fillRect(u,0,n,g),u+=n,s=0;42>s;s++)"1"===v[s]&&t.fillRect(u,0,n,h),u+=n;for(u+=n,t.fillRect(u,0,n,g),u+=2*n,t.fillRect(u,0,n,g),u+=2*n,s=42;84>s;s++)"1"===v[s]&&t.fillRect(u,0,n,h),u+=n;if(t.fillRect(u,0,n,g),u+=2*n,t.fillRect(u,0,n,g),e.number){t.font=d.font_size*h+"px monospace",e.prefix&&t.fillText(q,0,g*d.font_y);var w=3*n+(e.prefix?d.prefix_offset*f.width:0);a.each(b.substr(0,6).split(""),function(a){t.fillText(a,w,g*d.font_y),w+=d.font_stretch*m}),w=49*n+(e.prefix?d.prefix_offset*f.width:0),a.each(b.substr(6).split(""),function(a){t.fillText(a,w,g*d.font_y),w+=d.font_stretch*m})}}else e.onError.call(this)})}}(jQuery);