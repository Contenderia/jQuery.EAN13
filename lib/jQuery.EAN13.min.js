/* 
* Copyright (c) 2012 Johannes Mittendorfer (http://jmittendorfer.hostingsociety.com)
* Licensed under the MIT License (LICENSE.txt).
*
* Version: 0.6
*/
(function(k){k.fn.EAN13=function(i,r){var f=k.extend({number:!0,prefix:!0,onValid:function(){},onInvalid:function(){},onError:function(){}},r),g=this[0];return this.each(function(){var l=i.split(""),m=!0,n=0;k.each(l,function(a,b){n+=m?parseInt(b):3*parseInt(b);m=m?!1:!0});0==n%10?f.onValid.call(this):r.onInvalid.call(this);var a="0001101 0011001 0010011 0111101 0100011 0110001 0101111 0111011 0110111 0001011".split(" "),s="0100111 0110011 0011011 0100001 0011101 0111001 0000101 0010001 0001001 0010111".split(" "),
t="1110010 1100110 1101100 1000010 1011100 1001110 1010000 1000100 1001000 1110100".split(" "),p=f.prefix?0.8*g.width:g.width,e=f.number?0.9*g.height:1*g.height,l=0.9*e,b=p/95,h="",u="xxxxxx xxyxyy xxyyxy xxyyyx xyxxyy xyyxxy xyyyxx xyxyxy xyxyyx xyyxyx".split(" ")[parseInt(i.substr(0,1))].split(""),v=i.substr(0,1);i=i.substr(1);for(var q=i.split(""),c=0;6>c;c++)h="x"==u[c]?h+a[q[c]]:h+s[q[c]];for(c=6;12>c;c++)h+=t[q[c]];if(g.getContext){var d=g.getContext("2d");d.fillStyle="rgb(0, 0, 0)";a=f.prefix?
0.07*g.width:0;h=h.split("");d.fillRect(a,0,b,e);a+=2*b;d.fillRect(a,0,b,e);a+=b;for(c=0;42>c;c++)"1"==h[c]&&d.fillRect(a,0,b,l),a+=b;a+=b;d.fillRect(a,0,b,e);a+=2*b;d.fillRect(a,0,b,e);a+=2*b;for(c=42;84>c;c++)"1"==h[c]&&d.fillRect(a,0,b,l),a+=b;d.fillRect(a,0,b,e);d.fillRect(a+2*b,0,b,e);if(f.number){d.font=0.2*l+"px monospace";f.prefix&&d.fillText(v,0,1.03*e);var j=3*b+(f.prefix?0.07*g.width:0);k.each(i.substr(0,6).split(""),function(a,b){d.fillText(b,j,1.03*e);j+=0.078*p});j=49*b+(f.prefix?0.07*
g.width:0);k.each(i.substr(6).split(""),function(a,b){d.fillText(b,j,1.03*e);j+=0.078*p})}}else f.onError.call(this)})}})(jQuery);